# =============================================
#  Archivo: /app/main.py
# =============================================
"""
Archivo principal del proyecto FastAPI.
Monta las rutas y lanza la aplicaci贸n.
"""

from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware
from app.routes.predict_routes import router as predict_router
from app.routes.dashboard_routes import router as dashboard_router

# Crear aplicaci贸n FastAPI
app = FastAPI(
    title="Bank Marketing Predictor (Local)",
    description="""
    API local para predecir la aceptaci贸n de campa帽as bancarias.
    
    Caracter铆sticas:
    * Predicci贸n basada en 谩rbol de decisi贸n
    * Validaci贸n completa de datos de entrada
    * Vinculaci贸n con clientes existentes
    * Registro autom谩tico de predicciones
    * Documentaci贸n interactiva OpenAPI
    * Dashboard API endpoints
    """,
    version="1.0.0",
    contact={
        "name": "Equipo de ML",
        "url": "https://github.com/yourusername/bank_marketing_local"
    }
)

# Configurar CORS
origins = [
    "http://localhost:8050",  # Dash app
    "http://127.0.0.1:8050"   # Dash app alternative URL
]

app.add_middleware(
    CORSMiddleware,
    allow_origins=origins,
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"]
)

# Incluir rutas
app.include_router(predict_router)
app.include_router(dashboard_router)

@app.get("/", 
    tags=["Inicio"],
    summary="Endpoint de bienvenida",
    description="Verifica que la API est谩 funcionando correctamente."
)
def home():
    """Endpoint de bienvenida que confirma que la API est谩 activa."""
    return {
        "message": "API de predicciones bancarias funcionando ",
        "docs": "Visita /docs para la documentaci贸n interactiva",
        "health": "OK"
    }